
<html>
  <head> 
    <meta http-equiv="Content-Type" content="text/html"; charset="utf-8" />
  </head> 

  <body>
    <h1>将JavaScript中字符串转换成CharCode数组</h1>
    <p>
      输入：
    </p>
    <p>
      <textarea id="input" style="width: 60%; height: 15em;"></textarea>
    </p>
    <p>
      输出：
    </p>
    <p>
      <textarea id="output" style="width: 60%; height: 15em;"></textarea>
    </p>
    <p>
      <button id="tran">翻译</button>
      <button id="run">执行测试</button>
    <p>
    <script>
      (function(){
        var input = document.getElementById('input');
        var output = document.getElementById('output');
        var tran = document.getElementById('tran');

        tran.onclick = function(){
          var code = input.value;
          var new_code = 'var code2str=function(a){return a.map(function(i){return String.fromCharCode(i)}).reduce(function(a,b){return a+b})};\n';

          var in_string = false;
          var quote = null;

          for (var i=0, l=code.length; i<l; i++){
            var c = code[i];
            if (in_string){
              if (c === quote && code[i-1] !== '\\'){
                quote = null;
                in_string = false;
                new_code = new_code + '])';
              }
              else{
                new_code = new_code + c.charCodeAt(0) + ',';
              }
            }
            else if (c === '"' || c === "'"){
              quote = c;
              in_string = true;
              new_code = new_code + 'code2str([';
            }
            else {
              new_code = new_code + c;
            }
          }

          output.value = new_code;
        };

        run.onclick = function(){
          eval(output.value);
        };
      })();
      
    </script>
  </body>

</html>
