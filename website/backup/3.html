<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<base href="http://lovearia.me/article/show/3"><style type="text/css">body { margin-left:0;margin-right:0;margin-top:0; }#google-cache-hdr {background:#f5f5f5 !important;font:13px arial,sans-serif !important;text-align:left !important;color:#202020 !important;border:0 !important;margin:0 !important;border-bottom:1px solid #cecece !important;line-height:16px !important ;padding:16px 28px 24px 28px !important;}#google-cache-hdr * {display:inline !important;font:inherit !important;text-align:inherit !important;color:inherit !important;line-height:inherit !important;background:none !important;border:0 !important;margin:0 !important;padding:0 !important;letter-spacing:0 !important;}#google-cache-hdr a {text-decoration:none !important;color:#1a0dab !important;}#google-cache-hdr a:hover { text-decoration:underline !important; }#google-cache-hdr a:visited { color:#609 !important; }#google-cache-hdr div { display:block !important;margin-top:4px !important; }#google-cache-hdr b {font-weight:bold !important;display:inline-block !important;direction:ltr !important;}</style><div id="google-cache-hdr"  dir=ltr><div>This is Google&#39;s cache of <a href="http://lovearia.me/article/show/3" dir="ltr">http://lovearia.me/article/show/3</a>. It is a snapshot of the page as it appeared on Jul 23, 2016 23:49:01 GMT. </div><div>The <a href="http://lovearia.me/article/show/3" dir="ltr">current page</a> could have changed in the meantime. <a href="http://support.google.com/websearch/bin/answer.py?hl=en&amp;p=cached&amp;answer=1687222">Learn more</a></div><div></div><div><span style="display:inline-block !important;margin-top:8px !important;margin-right:104px !important;white-space:nowrap !important;"><span style="margin-right:28px !important;"><span style="font-weight:bold !important;">Full version</span></span><span style="margin-right:28px !important;"><a href="http://webcache.googleusercontent.com/search?q=cache:lovearia.me/article/show/3&amp;num=1&amp;ie=UTF-8&amp;prmd=ivns&strip=1&vwsrc=0">Text-only version</a></span><span style="margin-right:28px !important;"><a href="http://webcache.googleusercontent.com/search?q=cache:lovearia.me/article/show/3&amp;num=1&amp;ie=UTF-8&amp;prmd=ivns&strip=0&vwsrc=1">View source</a></span></span><span style="display:inline-block !important;margin-top:8px !important;color:#717171 !important;">Tip: To quickly find your search term on this page, press <b>Ctrl+F</b> or <b>⌘-F</b> (Mac) and use the find bar.</span></div></div><div style="position:relative;">
<html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="description" content="Brambles' Blog."/><title>LoveAria.Me - 【瞎扯】谈谈纯函数式语言中的“纯”</title><link rel="shortcut icon" href="/favicon.ico"/><link rel="stylesheet" href="//cdn.jsdelivr.net/g/pure@0.6.0,github-markdown-css@2.2.1,highlight.js@9.2.0(styles/github.min.css)"/><link rel="stylesheet" href="/static/css/main.css"/><script src="//cdn.jsdelivr.net/jquery/2.2.1/jquery.min.js"></script><script src="/static/js/main.js"></script></head><body><div id="layout"><a href="javascript:void(0);" id="menuLink" class="menu-link"><span></span></a><div id="menu"><div class="pure-menu"><a class="pure-menu-heading">LOVEARIA.ME</a><ul class="pure-menu-list"><li class="pure-menu-item"><a class="pure-menu-link" href="/">首页</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/#作者">作者</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/#联系">联系</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/article">文章</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/category">分类</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="https://github.com/bramblex">Github</a></li><li class="pure-menu-item menu-item-divided"><a class="pure-menu-link" href="/user/login">登录</a></li></ul></div></div><div id="main"><div class="header"><h1>【瞎扯】谈谈纯函数式语言中的“纯”</h1><h2></h2></div><div class="content"><div class="pure-u-1 article-toolbar"><div class="article-category">分类： <a href="/article/category/0">根分类</a> > <a href="/article/category/1">技术杂谈</a></div></div><div class="article markdown-body"><h2>目录</h2><ul><li><a href="#什么是-纯-">什么是 “纯”</a></li><li><a href="#什么是-副作用-">什么是 “副作用”</a></li><li><a href="#-副作用-的弊端">“副作用” 的弊端</a></li><li><a href="#如何对待-副作用-">如何对待 “副作用”</a></li><li><a href="#写在最后">写在最后</a></li></ul></ul><p>编程语言中有那么一类奇葩，叫做纯函数是语言，比如我经常安利的大 Haskell 。奇葩在于哪里呢？他是一门函数式语言，并且是一门纯函数式语言。函数式语言是什么鬼我就不展开来讨论了，函数式语言对应的是命令式语言。请丝毫不用怀疑，这个世界上绝大部分人写代码都是使用命令式语言，你能在市面上看见的语言无一例外，全是命令式语言。并且无一例外，都在发展的过程中大抄特抄函数式语言的特性，比如 Java8 还出了一本书来讲它新加了那么一点点函数式特性（日常黑Java）。</p>
<p>好吧，不扯蛋了，接下先从什么是纯来切入正题吧~ ╮(╯▽╰)╭</p>
<h2><a name="什么是-纯-" class="anchor" href="#什么是-纯-"><span class="header-link">▶</span></a>什么是 “纯”</h2><p>纯就是不污的意思~所以不需要去污……不不不，纯是没有 “副作用” 的意思，那什么又是副作用呢？纯函数中的 “纯” 是指没有 “副作用” 的意思，那么没有 “副作用” 的函数是一个什么样的函数呢？</p>
<p>我们想一下我们数学中的函数是怎么干的。数学中的函数就是接受一个或者多个参数，然后给你返回一个值对不？现在我们令 f(x) = x * 2 ，是不是不管什么情况下，只要 x 一定了 f(x) 就一定也固定了啊？好，编程语言中的纯函数跟数学里面这个函数是相似的。只要参数一定，那么返回的结果也一定，这样一个函数就称之为纯函数了。</p>
<p>等等，上面说了一大段，但是好像并没有跟副作用扯上关系啊？好接下来我们来讲什么是副作用。</p>
<h2><a name="什么是-副作用-" class="anchor" href="#什么是-副作用-"><span class="header-link">▶</span></a>什么是 “副作用”</h2><p>上一小节已经讲了在编程语言中，一个怎么样函数才称之为纯函数，接下来我们要讲一个纯函数的重要特点，没有副作用。没有副作用指的是什么呢？没有副作用可以概括为两点：1，不依赖环境。2，不对境产生影响。</p>
<p>怎么理解不依赖外部环境呢？假设，我现在有一个纯函数 pureFunc 接受一个参数并且返回一个值 ，它在任意两个不同的环境 EnvA 和 EnvB 中，给定相同的参数 a1 ，那么 pureFunc 的在 EnvA 中和 Env B 中的返回也是一致的，这就说明了 pureFunc 这个函数不依赖于环境。</p>
<p>假设，一个纯函数 pureFunc 接受一个参数并且返回一个值，令 pureFunc 执行前的环境是 EnvA ，pureFunc 执行后的环境是 EnvA&#39; ，任何情况下 EnvA 与 EnvA&#39; 相同，则说明 pureFunc 不对环境产生影响。</p>
<p>两点都说明完了，但是有些同学就要开始问了。你说的是啥？我听不明白啊！好，下面开始用简单的 JavaScript 例子（我就喜欢用 JavaScript ，你打我呀）给大家讲解一下</p>
<pre><code class="lang-JavaScript"><span class="hljs-keyword">var</span> a = <span class="hljs-number">1</span>;

<span class="hljs-keyword">var</span> f = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">b</span>)</span>{
    <span class="hljs-keyword">return</span> a + b; <span class="hljs-comment">// 依赖外部的环境 a</span>
};

<span class="hljs-keyword">var</span> g = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">c</span>)</span>{
    a = c; <span class="hljs-comment">// 对外部的环境产生影响</span>
};

<span class="hljs-keyword">var</span> h = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>)</span>{
    <span class="hljs-keyword">return</span> a + b; <span class="hljs-comment">// 不依赖外部的环境，是一个纯函数</span>
};
</code></pre>
<p>上面这个例子中的 f 函数依赖于外部环境， g 函数会对外部环境产生影响，所以都不纯（需要去污粉，强效去污)。只有 h 函数是独善其身的乖孩子，既不受他人影响，也不影响他人。</p>
<p>当然，所谓的外部环境不仅仅是变量，还有可能是环境变量或者是IO（输入输出等）。我们接下来继续谈。</p>
<h2><a name="-副作用-的弊端" class="anchor" href="#-副作用-的弊端"><span class="header-link">▶</span></a>“副作用” 的弊端</h2><p>相信大家在入门 C/C艹 之类的语言的时候，老手们会教给大家一个非常朴素的经验或者规范——尽量少使用全局变量。</p>
<p>为什么少使用全局变量呀？看到上面我举的副作用的例子了吗？当一个函数在使用全局变量的时候，是不是依赖于外部环境了？当一个函数在改变全局变量的时候，是不是就是改变环境了？这不就是产生了副作用吗？所以，这些老手们虽然都还没有看清楚不使用全局变量真正的意义是什么，但是多年的踩坑经验还是给他们提供了一条正确的路。</p>
<p>当一个函数依赖环境或者是改变环境的时候，也就是说当一个函数 “不纯” 的时候，它就给它的返回以及所在的环境带来了不可控的因素，增加了复杂度。一个两个函数可能看不出什么问题，但是一旦当代码量增长、程序变复杂的时候，这种复杂度和不可控就会指数增长。副作用对测试也会造成很大困扰，因为副作用只能在程序实际运行的时候才具有真正意义上的环境。所以副作用很容易带来一些无法通过单元测试而排除的运行时的 Bug ……当一个程序代码里面到处都是副作用的代码的时候……你给这个程序排 Bug 就真的可能是拆东墙补西墙，修一个 Bug 引进一堆 Bug ……</p>
<h2><a name="如何对待-副作用-" class="anchor" href="#如何对待-副作用-"><span class="header-link">▶</span></a>如何对待 “副作用”</h2><p>如果说副作用是不好的。那能不能干脆把一个程序所有的副作用去掉就好了呢？答案肯定是否定的。为什么呢？并不是说一个程序没有副作用就不行，而是作为一个有用的程序来说，副作用是不可或缺的，比如输入和输出。一个程序跟外界的交互都是有副作用的，但是一个完全不跟外界交互的程序，那除了占内存占CPU以外你告诉我还有啥用？连写的 Hello Word 也是有副作用的啊！</p>
<p>既然一个有用的程序不可能完全消除副作用，但是副作用又不是什么好东西，那我们应该如何对待副作用呢？答案是——隔离。将有副作用的操作，和逻辑隔离开来，从而防止副作用蔓延。在这方面，我经常安利的大 Haskell 是一个极端的例子……它在普通函数里面完全不允许出现副作用，而所有副作用都包在一个叫做 IO Monad 的 Monad 里面和其他代码隔离……但是由于本身 Monad 这个概念比较 “高深”（装逼），结果新手们跑来写个 Hellow World 都写不利索……</p>
<p>但是像 Haskell 那样极端的隔离副作用也不见得是什么好事。毕竟什么东西都有一个度，像 Haskell 这样处理副作用，真的就是把简单的东西搞复杂了。</p>
<h2><a name="写在最后" class="anchor" href="#写在最后"><span class="header-link">▶</span></a>写在最后</h2><p>扯了那么长一溜，终于把蛋扯完了。所以纯函数语言中所追求的“纯”到底有什么意义呢？它的意义可能真的没有什么太高深的东西，它只是用了一种极端的手段强迫你写出易于测试，易于验证的代码。我在写 Haskell 系的代码经常都是只要能编译通过不报 waring ，那基本上代码的所有分支都是没有错误的，要出错了只能是我逻辑些错了。这种感觉还是非常安心的。</p>
<p>我就在想，现在那么多人都在嚷嚷着 TDD （测试驱动开发），但是到底有多少人懂得如何去写易于测试、易于验证的代码呢？╮(╯-╰)╭</p>
</div><div class="article-date"><small>2016-03-08 12:05:59 | 2016-02-29 17:21:13</small></div><div class="pure-u-1 comments"><div class="pure-g"><div class="pure-u-1" id="disqus_thread"></div><script>var disqus_config = function () {this.page.identifier = "article_3"; this.page.title = document.title; this.page.url = location.href;}; (function() { var d = document, s = d.createElement('script'); s.src = '//lovearia.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s);})();</script></div></div></div><div class="footer"></div></div></div></body></html>